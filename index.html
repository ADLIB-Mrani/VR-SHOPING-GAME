<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="VR Shopping Game - Magasin en r√©alit√© virtuelle avec livraison r√©elle">
    <meta name="keywords" content="VR, shopping, r√©alit√© virtuelle, e-commerce, A-Frame">
    <meta name="author" content="ADLIB-Mrani">
    <title>VR Shopping Game - Magasin en R√©alit√© Virtuelle</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/collision-system.js"></script>
    <script src="js/vr-store.js"></script>
    <script src="js/cart-system.js"></script>
    <script src="js/product-interactions.js"></script>
    <script src="js/proximity-purchase.js"></script>
    <script src="js/search-filter.js"></script>
    <script src="js/order-history.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader">
            <div class="spinner"></div>
            <p>Chargement du magasin VR...</p>
            <small>Cela peut prendre quelques secondes</small>
            <div id="loading-error" style="display:none; margin-top:20px; color:#ff6b6b;">
                <p>‚ö†Ô∏è Erreur de chargement</p>
                <small>V√©rifiez votre connexion Internet et rechargez la page</small>
            </div>
        </div>
    </div>

    <!-- Help Button -->
    <button id="help-btn" class="floating-btn" title="Aide">
        <span>?</span>
    </button>

    <!-- Help Panel -->
    <div id="help-panel" style="display:none;">
        <h2>üéÆ Aide - Contr√¥les</h2>
        <div class="help-section">
            <h3>üñ±Ô∏è Souris & Clavier</h3>
            <ul>
                <li><strong>WASD</strong> ou <strong>Fl√®ches</strong> - Se d√©placer</li>
                <li><strong>Souris</strong> - Regarder autour</li>
                <li><strong>Clic</strong> - S√©lectionner un produit</li>
            </ul>
        </div>
        <div class="help-section">
            <h3>üéÆ VR</h3>
            <ul>
                <li><strong>Joystick</strong> - Se d√©placer</li>
                <li><strong>T√™te</strong> - Regarder</li>
                <li><strong>G√¢chette</strong> - S√©lectionner</li>
            </ul>
        </div>
        <div class="help-section">
            <h3>üõí Shopping</h3>
            <ul>
                <li>Approchez-vous des produits</li>
                <li>Cliquez pour ajouter au panier</li>
                <li>G√©rez votre panier √† droite</li>
                <li>Cliquez "Commander" pour passer commande</li>
            </ul>
        </div>
        <button onclick="closeHelp()" class="close-help-btn">Fermer</button>
    </div>

    <div id="ui-overlay">
        <div id="cart-panel">
            <h2>üõí Panier</h2>
            <div id="cart-items"></div>
            <div id="cart-total">Total: 0‚Ç¨</div>
            <button id="checkout-btn" onclick="checkout()">Commander</button>
        </div>
        <div id="order-form" style="display:none;">
            <h2>Informations de livraison</h2>
            <form id="delivery-form">
                <input type="text" id="customer-name" placeholder="Nom complet" required>
                <input type="text" id="customer-address" placeholder="Adresse" required>
                <input type="text" id="customer-city" placeholder="Ville" required>
                <input type="text" id="customer-postal" placeholder="Code postal" required>
                <input type="tel" id="customer-phone" placeholder="T√©l√©phone" required>
                <button type="submit">Confirmer la commande</button>
                <button type="button" onclick="closeOrderForm()">Annuler</button>
            </form>
        </div>
        <div id="confirmation" style="display:none;">
            <h2>Commande confirm√©e!</h2>
            <p>Votre commande sera livr√©e dans le monde r√©el!</p>
            <p id="order-details"></p>
            <button onclick="closeConfirmation()">Continuer le shopping</button>
        </div>
    </div>

    <a-scene id="vr-scene" loading-screen="dotsColor: #4CC3D9; backgroundColor: #1a1a1a">
        <!-- Asset Management -->
        <a-assets>
            <!-- Textures can be added here for enhanced visuals -->
            <!-- <img id="floor-texture" src="assets/textures/floor.jpg" crossorigin="anonymous"> -->
            <!-- <img id="wall-texture" src="assets/textures/wall.jpg" crossorigin="anonymous"> -->
        </a-assets>

        <!-- Store Environment -->
        <a-entity id="store-environment">
            <!-- Floor -->
            <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" 
                     color="#8B7D6B" shadow="receive: true" wall-collision
                     material="color: #8B7D6B; repeat: 10 10; roughness: 0.8"></a-plane>
            
            <!-- Walls -->
            <a-box position="0 2 -10" width="20" height="4" depth="0.2" color="#E8E0D5" wall-collision solid
                   material="color: #E8E0D5; roughness: 0.5"></a-box>
            <a-box position="-10 2 0" width="0.2" height="4" depth="20" color="#E8E0D5" wall-collision solid
                   material="color: #E8E0D5; roughness: 0.5"></a-box>
            <a-box position="10 2 0" width="0.2" height="4" depth="20" color="#E8E0D5" wall-collision solid
                   material="color: #E8E0D5; roughness: 0.5"></a-box>
            <a-box position="0 2 10" width="20" height="4" depth="0.2" color="#E8E0D5" wall-collision solid
                   material="color: #E8E0D5; roughness: 0.5"></a-box>
            
            <!-- Ceiling -->
            <a-plane position="0 4 0" rotation="90 0 0" width="20" height="20" color="#F5F5F5" 
                     material="color: #F5F5F5; metalness: 0.2"></a-plane>
            
            <!-- Lighting -->
            <a-light type="ambient" intensity="0.5"></a-light>
            <a-light type="directional" position="2 4 2" intensity="0.8" castShadow="true"></a-light>
            <a-light type="point" position="-5 3 -5" intensity="0.5"></a-light>
            <a-light type="point" position="5 3 5" intensity="0.5"></a-light>
        </a-entity>

        <!-- Product Displays -->
        <a-entity id="products">
            <!-- Electronics Section -->
            <a-entity position="-7 0 -7">
                <a-text value="√âlectronique" position="0 2.5 0" align="center" color="#333" width="6"></a-text>
                
                <!-- Display Table -->
                <a-box position="0 0.8 0" width="4" height="0.1" depth="2" color="#8B7355" product-collision solid
                       material="color: #8B7355; metalness: 0.3; roughness: 0.7"></a-box>
                
                <!-- Laptop -->
                <a-entity class="product" data-id="laptop" data-name="Ordinateur Portable" data-price="999" position="-1 1.2 0" product-collision solid>
                    <a-box color="#2C3E50" depth="0.8" height="0.05" width="1.2" 
                           material="color: #2C3E50; metalness: 0.8; roughness: 0.2"></a-box>
                    <a-box color="#34495E" depth="0.02" height="0.9" width="1.2" position="0 0.5 -0.4"
                           material="color: #34495E; metalness: 0.5; roughness: 0.3"></a-box>
                    <a-text value="Laptop\n999‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Smartphone -->
                <a-entity class="product" data-id="phone" data-name="Smartphone" data-price="699" position="1 1.2 0" product-collision solid>
                    <a-box color="#1A1A1A" depth="0.1" height="1.5" width="0.7"
                           material="color: #1A1A1A; metalness: 0.7; roughness: 0.2"></a-box>
                    <a-plane color="#4A90E2" depth="0.01" height="1.3" width="0.6" position="0 0 0.051"
                             material="color: #4A90E2; emissive: #2E5C8A; emissiveIntensity: 0.3"></a-plane>
                    <a-text value="Phone\n699‚Ç¨" position="0 -0.5 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
            </a-entity>

            <!-- Clothing Section -->
            <a-entity position="7 0 -7">
                <a-text value="V√™tements" position="0 2.5 0" align="center" color="#333" width="6"></a-text>
                
                <!-- Display Table -->
                <a-box position="0 0.8 0" width="4" height="0.1" depth="2" color="#8B7355" product-collision solid
                       material="color: #8B7355; metalness: 0.3; roughness: 0.7"></a-box>
                
                <!-- T-Shirt -->
                <a-entity class="product" data-id="tshirt" data-name="T-Shirt" data-price="29" position="-1 1.5 0" product-collision solid>
                    <a-cylinder color="#E74C3C" height="1" radius="0.5"
                                material="color: #E74C3C; roughness: 0.8"></a-cylinder>
                    <a-text value="T-Shirt\n29‚Ç¨" position="0 -0.8 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Jeans -->
                <a-entity class="product" data-id="jeans" data-name="Jean" data-price="79" position="1 1.5 0" product-collision solid>
                    <a-cylinder color="#3498DB" height="1.2" radius="0.4"
                                material="color: #3498DB; roughness: 0.9"></a-cylinder>
                    <a-text value="Jeans\n79‚Ç¨" position="0 -0.8 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Shoes -->
                <a-entity class="product" data-id="shoes" data-name="Chaussures de Sport" data-price="120" position="-1 1.2 -1.5" product-collision solid>
                    <a-box color="#2C3E50" depth="0.8" height="0.3" width="0.4"
                           material="color: #2C3E50; metalness: 0.2; roughness: 0.7"></a-box>
                    <a-box color="#E74C3C" depth="0.8" height="0.2" width="0.4" position="0 0.25 0"
                           material="color: #E74C3C; roughness: 0.6"></a-box>
                    <a-text value="Shoes\n120‚Ç¨" position="0 -0.5 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Jacket -->
                <a-entity class="product" data-id="jacket" data-name="Veste en Cuir" data-price="199" position="1 1.5 -1.5" product-collision solid>
                    <a-cylinder color="#1A1A1A" height="1.3" radius="0.5"
                                material="color: #1A1A1A; metalness: 0.4; roughness: 0.3"></a-cylinder>
                    <a-text value="Jacket\n199‚Ç¨" position="0 -0.8 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
            </a-entity>

            <!-- Home Decor Section -->
            <a-entity position="-7 0 7">
                <a-text value="D√©coration" position="0 2.5 0" align="center" color="#333" width="6"></a-text>
                
                <!-- Display Table -->
                <a-box position="0 0.8 0" width="4" height="0.1" depth="2" color="#8B7355" product-collision solid
                       material="color: #8B7355; metalness: 0.3; roughness: 0.7"></a-box>
                
                <!-- Lamp -->
                <a-entity class="product" data-id="lamp" data-name="Lampe Design" data-price="149" position="-1 1 0" product-collision solid>
                    <a-cylinder color="#F39C12" height="1.5" radius="0.15" position="0 0.75 0"
                                material="color: #F39C12; metalness: 0.6; roughness: 0.3"></a-cylinder>
                    <a-cone color="#ECF0F1" height="0.8" radius-bottom="0.5" radius-top="0.2" position="0 1.9 0"
                            material="color: #ECF0F1; emissive: #FFF; emissiveIntensity: 0.2"></a-cone>
                    <a-text value="Lampe\n149‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Vase -->
                <a-entity class="product" data-id="vase" data-name="Vase C√©ramique" data-price="59" position="1 1 0" product-collision solid>
                    <a-cylinder color="#16A085" height="1" radius-bottom="0.3" radius-top="0.4"
                                material="color: #16A085; roughness: 0.4; metalness: 0.2"></a-cylinder>
                    <a-text value="Vase\n59‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Picture Frame -->
                <a-entity class="product" data-id="frame" data-name="Cadre Photo" data-price="35" position="-1 1.5 -1.5" product-collision solid>
                    <a-box color="#654321" depth="0.1" height="1" width="0.8"
                           material="color: #654321; roughness: 0.8"></a-box>
                    <a-plane color="#E8E8E8" depth="0.05" height="0.8" width="0.6" position="0 0 0.055"
                             material="color: #E8E8E8"></a-plane>
                    <a-text value="Cadre\n35‚Ç¨" position="0 -0.6 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Clock -->
                <a-entity class="product" data-id="clock" data-name="Horloge Murale" data-price="89" position="1 1.5 -1.5" product-collision solid>
                    <a-cylinder color="#2C3E50" height="0.2" radius="0.5"
                                material="color: #2C3E50; metalness: 0.7; roughness: 0.2"></a-cylinder>
                    <a-plane color="#ECF0F1" height="0.9" width="0.9" position="0 0 0.11" rotation="0 0 0"
                             material="color: #ECF0F1"></a-plane>
                    <a-text value="Horloge\n89‚Ç¨" position="0 -0.6 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
            </a-entity>

            <!-- Food Section -->
            <a-entity position="7 0 7">
                <a-text value="Alimentation" position="0 2.5 0" align="center" color="#333" width="6"></a-text>
                
                <!-- Display Table -->
                <a-box position="0 0.8 0" width="4" height="0.1" depth="2" color="#8B7355" product-collision solid
                       material="color: #8B7355; metalness: 0.3; roughness: 0.7"></a-box>
                
                <!-- Coffee -->
                <a-entity class="product" data-id="coffee" data-name="Caf√© Premium" data-price="12" position="-1 1 0" product-collision solid>
                    <a-cylinder color="#6F4E37" height="1" radius="0.3"
                                material="color: #6F4E37; roughness: 0.9"></a-cylinder>
                    <a-text value="Caf√©\n12‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Chocolate -->
                <a-entity class="product" data-id="chocolate" data-name="Chocolat Artisanal" data-price="8" position="1 1 0" product-collision solid>
                    <a-box color="#3E2723" depth="0.5" height="0.3" width="1"
                           material="color: #3E2723; roughness: 0.6"></a-box>
                    <a-text value="Chocolat\n8‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Wine Bottle -->
                <a-entity class="product" data-id="wine" data-name="Vin Rouge" data-price="45" position="-1 1.3 -1.5" product-collision solid>
                    <a-cylinder color="#722F37" height="1.5" radius="0.15"
                                material="color: #722F37; metalness: 0.3; roughness: 0.2"></a-cylinder>
                    <a-cone color="#1A1A1A" height="0.3" radius-bottom="0.15" radius-top="0.05" position="0 0.9 0"
                            material="color: #1A1A1A"></a-cone>
                    <a-text value="Vin\n45‚Ç¨" position="0 -0.8 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Cheese -->
                <a-entity class="product" data-id="cheese" data-name="Fromage Artisanal" data-price="18" position="1 1 -1.5" product-collision solid>
                    <a-box color="#FFF8DC" depth="0.6" height="0.3" width="0.6"
                           material="color: #FFF8DC; roughness: 0.9"></a-box>
                    <a-text value="Fromage\n18‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
            </a-entity>
            
            <!-- Books Section -->
            <a-entity position="0 0 -7">
                <a-text value="Livres" position="0 2.5 0" align="center" color="#333" width="6"></a-text>
                
                <!-- Bookshelf -->
                <a-box position="0 1.5 0" width="3" height="2.5" depth="0.4" color="#654321" product-collision solid
                       material="color: #654321; roughness: 0.8"></a-box>
                
                <!-- Book 1 -->
                <a-entity class="product" data-id="book1" data-name="Roman Bestseller" data-price="22" position="-0.8 1.8 0.3" product-collision solid>
                    <a-box color="#C0392B" depth="0.15" height="1" width="0.7"
                           material="color: #C0392B; roughness: 0.7"></a-box>
                    <a-text value="Roman\n22‚Ç¨" position="0 -0.6 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Book 2 -->
                <a-entity class="product" data-id="book2" data-name="Guide Cuisine" data-price="28" position="0 1.8 0.3" product-collision solid>
                    <a-box color="#16A085" depth="0.15" height="1" width="0.7"
                           material="color: #16A085; roughness: 0.7"></a-box>
                    <a-text value="Cuisine\n28‚Ç¨" position="0 -0.6 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Book 3 -->
                <a-entity class="product" data-id="book3" data-name="Encyclop√©die" data-price="35" position="0.8 1.8 0.3" product-collision solid>
                    <a-box color="#2C3E50" depth="0.15" height="1" width="0.7"
                           material="color: #2C3E50; roughness: 0.7"></a-box>
                    <a-text value="Encyclopedia\n35‚Ç¨" position="0 -0.6 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
            </a-entity>
            
            <!-- Sports Section -->
            <a-entity position="0 0 7">
                <a-text value="Sport" position="0 2.5 0" align="center" color="#333" width="6"></a-text>
                
                <!-- Display Table -->
                <a-box position="0 0.8 0" width="4" height="0.1" depth="2" color="#8B7355" product-collision solid
                       material="color: #8B7355; metalness: 0.3; roughness: 0.7"></a-box>
                
                <!-- Basketball -->
                <a-entity class="product" data-id="basketball" data-name="Ballon de Basket" data-price="35" position="-1 1.5 0" product-collision solid>
                    <a-sphere color="#FF6600" radius="0.4"
                              material="color: #FF6600; roughness: 0.8"></a-sphere>
                    <a-text value="Basket\n35‚Ç¨" position="0 -0.6 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Yoga Mat -->
                <a-entity class="product" data-id="yogamat" data-name="Tapis de Yoga" data-price="45" position="1 1 0" product-collision solid>
                    <a-cylinder color="#9B59B6" height="0.1" radius="0.3"
                                material="color: #9B59B6; roughness: 0.9"></a-cylinder>
                    <a-text value="Yoga\n45‚Ç¨" position="0 -0.3 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
                
                <!-- Dumbbells -->
                <a-entity class="product" data-id="dumbbells" data-name="Halt√®res 5kg" data-price="55" position="-1 1 -1.5" product-collision solid>
                    <a-cylinder color="#34495E" height="0.8" radius="0.15" rotation="0 0 90"
                                material="color: #34495E; metalness: 0.8; roughness: 0.2"></a-cylinder>
                    <a-sphere color="#34495E" radius="0.2" position="-0.5 0 0"
                              material="color: #34495E; metalness: 0.8; roughness: 0.2"></a-sphere>
                    <a-sphere color="#34495E" radius="0.2" position="0.5 0 0"
                              material="color: #34495E; metalness: 0.8; roughness: 0.2"></a-sphere>
                    <a-text value="Halt√®res\n55‚Ç¨" position="0 -0.5 0" align="center" width="3" color="#000"></a-text>
                </a-entity>
            </a-entity>
        </a-entity>

        <!-- Info Signs -->
        <a-entity position="0 2.5 -9">
            <a-text value="üéÆ Bienvenue dans votre magasin VR!" 
                    align="center" width="10" color="#667eea"></a-text>
        </a-entity>
        
        <a-entity position="0 1.8 -9">
            <a-text value="WASD = Se d√©placer | Souris = Regarder | Clic = Acheter" 
                    align="center" width="8" color="#2C3E50"></a-text>
        </a-entity>
        
        <a-entity position="0 1.3 -9">
            <a-text value="üí∞ Livraison GRATUITE √† partir de 100‚Ç¨!" 
                    align="center" width="7" color="#27AE60"></a-text>
        </a-entity>
        
        <!-- Directional arrows -->
        <a-entity position="-9 1.5 0" rotation="0 90 0">
            <a-text value="‚Üê √âlectronique" align="center" width="5" color="#3498DB"></a-text>
        </a-entity>
        
        <a-entity position="9 1.5 0" rotation="0 -90 0">
            <a-text value="V√™tements ‚Üí" align="center" width="5" color="#E74C3C"></a-text>
        </a-entity>

        <!-- Camera/Player -->
        <a-entity id="rig" position="0 1.6 5" movement-constraints>
            <a-camera id="camera" look-controls wasd-controls="acceleration: 50">
                <a-cursor color="#4CC3D9" raycaster="objects: .product, .purchase-btn, .qty-btn"></a-cursor>
            </a-camera>
        </a-entity>
        
        <!-- Shopping Cart Visual Representation -->
        <a-entity id="cart-visual" position="9 1 9" product-collision solid>
            <a-box position="0 0.5 0" width="1" height="0.8" depth="0.8" color="#E74C3C"
                   material="color: #E74C3C; opacity: 0.8; metalness: 0.5"></a-box>
            <a-text value="üõí PANIER" position="0 1.2 0" align="center" width="4" color="#E74C3C"></a-text>
        </a-entity>

        <!-- Sky -->
        <a-sky color="#87CEEB"></a-sky>
    </a-scene>

    <script>
        // Check if A-Frame loaded successfully
        setTimeout(function() {
            if (typeof AFRAME === 'undefined') {
                const loadingError = document.getElementById('loading-error');
                if (loadingError) {
                    loadingError.style.display = 'block';
                }
                console.error('A-Frame failed to load. Please check your internet connection.');
            }
        }, 5000);
        
        // Initialize the VR store when the scene is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initVRStore();
        });
    </script>
</body>
</html>
