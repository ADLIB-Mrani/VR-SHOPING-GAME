<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Shopping Game - Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2C3E50;
            text-align: center;
        }
        h2 {
            color: #4CC3D9;
            border-bottom: 2px solid #4CC3D9;
            padding-bottom: 10px;
        }
        button {
            background: #4CC3D9;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #3BA3BC;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #27AE60;
        }
        .error {
            border-left-color: #E74C3C;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            padding: 8px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .success { color: #27AE60; font-weight: bold; }
        .fail { color: #E74C3C; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ðŸŽ® VR Shopping Game - Tests</h1>
    
    <div class="test-section">
        <h2>âœ… Tests du SystÃ¨me de Panier</h2>
        <button onclick="testCart()">Tester le Panier</button>
        <div id="cart-results"></div>
    </div>

    <div class="test-section">
        <h2>ðŸ“¦ Tests du Catalogue Produits</h2>
        <button onclick="testProducts()">Tester les Produits</button>
        <div id="product-results"></div>
    </div>

    <div class="test-section">
        <h2>ðŸšš Tests de l'API Livraison</h2>
        <button onclick="testDelivery()">Tester la Livraison</button>
        <div id="delivery-results"></div>
    </div>

    <div class="test-section">
        <h2>ðŸ”— Tests de Navigation</h2>
        <button onclick="window.location.href='index.html'">Ouvrir le Magasin VR</button>
        <button onclick="window.open('index.html', '_blank')">Ouvrir dans un Nouvel Onglet</button>
    </div>

    <script src="js/cart-system.js"></script>
    <script src="js/product-interactions.js"></script>
    <script src="js/delivery-api.js"></script>

    <script>
        function testCart() {
            const results = document.getElementById('cart-results');
            results.innerHTML = '<p>Tests en cours...</p>';
            
            let output = '<ul>';
            let allPassed = true;

            // Test 1: Create cart system
            try {
                const cart = new CartSystem();
                output += '<li class="success">âœ“ CartSystem crÃ©Ã© avec succÃ¨s</li>';
            } catch (e) {
                output += `<li class="fail">âœ— Erreur crÃ©ation CartSystem: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 2: Add item to cart
            try {
                const cart = new CartSystem();
                cart.clearCart();
                const result = cart.addItem({ id: 'test1', name: 'Test Product', price: 99 });
                if (result.length === 1) {
                    output += '<li class="success">âœ“ Ajout d\'article au panier rÃ©ussi</li>';
                } else {
                    output += '<li class="fail">âœ— ProblÃ¨me d\'ajout au panier</li>';
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur ajout article: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 3: Calculate total
            try {
                const cart = new CartSystem();
                cart.clearCart();
                cart.addItem({ id: 'test1', name: 'Test 1', price: 50 });
                cart.addItem({ id: 'test2', name: 'Test 2', price: 30 });
                const total = cart.calculateTotal();
                if (total === 80) {
                    output += '<li class="success">âœ“ Calcul du total correct (80â‚¬)</li>';
                } else {
                    output += `<li class="fail">âœ— Calcul du total incorrect: ${total}â‚¬ au lieu de 80â‚¬</li>`;
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur calcul total: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 4: Remove item
            try {
                const cart = new CartSystem();
                cart.clearCart();
                cart.addItem({ id: 'test1', name: 'Test', price: 50 });
                const removed = cart.removeItem('test1');
                if (removed.length === 0) {
                    output += '<li class="success">âœ“ Suppression d\'article rÃ©ussie</li>';
                } else {
                    output += '<li class="fail">âœ— ProblÃ¨me de suppression</li>';
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur suppression: ${e.message}</li>`;
                allPassed = false;
            }

            output += '</ul>';
            
            if (allPassed) {
                output = '<div class="result"><strong>Tous les tests du panier sont passÃ©s! âœ“</strong></div>' + output;
            } else {
                output = '<div class="result error"><strong>Certains tests ont Ã©chouÃ©! âœ—</strong></div>' + output;
            }
            
            results.innerHTML = output;
        }

        function testProducts() {
            const results = document.getElementById('product-results');
            results.innerHTML = '<p>Tests en cours...</p>';
            
            let output = '<ul>';
            let allPassed = true;

            // Test 1: Load product catalog
            try {
                if (typeof PRODUCT_CATALOG !== 'undefined' && Object.keys(PRODUCT_CATALOG).length > 0) {
                    output += `<li class="success">âœ“ Catalogue chargÃ©: ${Object.keys(PRODUCT_CATALOG).length} produits</li>`;
                } else {
                    output += '<li class="fail">âœ— Catalogue vide ou non chargÃ©</li>';
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur chargement catalogue: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 2: Get product info
            try {
                const product = getProductInfo('laptop');
                if (product && product.name && product.price) {
                    output += `<li class="success">âœ“ RÃ©cupÃ©ration produit: ${product.name} - ${product.price}â‚¬</li>`;
                } else {
                    output += '<li class="fail">âœ— Produit non trouvÃ©</li>';
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur rÃ©cupÃ©ration produit: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 3: Calculate shipping
            try {
                const cart = [
                    { id: 'laptop', quantity: 1, price: 999 }
                ];
                const shipping = calculateShipping(cart);
                output += `<li class="success">âœ“ Calcul livraison: ${shipping.cost}â‚¬ (Poids: ${shipping.weight}kg)</li>`;
            } catch (e) {
                output += `<li class="fail">âœ— Erreur calcul livraison: ${e.message}</li>`;
                allPassed = false;
            }

            output += '</ul>';
            
            if (allPassed) {
                output = '<div class="result"><strong>Tous les tests produits sont passÃ©s! âœ“</strong></div>' + output;
            } else {
                output = '<div class="result error"><strong>Certains tests ont Ã©chouÃ©! âœ—</strong></div>' + output;
            }
            
            results.innerHTML = output;
        }

        async function testDelivery() {
            const results = document.getElementById('delivery-results');
            results.innerHTML = '<p>Tests en cours...</p>';
            
            let output = '<ul>';
            let allPassed = true;

            // Test 1: Create delivery API
            try {
                const api = new DeliveryAPI();
                output += '<li class="success">âœ“ API de livraison crÃ©Ã©e</li>';
            } catch (e) {
                output += `<li class="fail">âœ— Erreur crÃ©ation API: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 2: Create order (simulated)
            try {
                const api = new DeliveryAPI();
                const orderData = {
                    orderNumber: 'TEST123',
                    name: 'Test User',
                    address: '123 Test St',
                    city: 'Paris',
                    postal: '75001',
                    phone: '0612345678',
                    items: [{ id: 'laptop', name: 'Laptop', price: 999, quantity: 1 }],
                    total: 999,
                    orderDate: new Date().toISOString()
                };
                const result = await api.createOrder(orderData);
                if (result.success && result.trackingNumber) {
                    output += `<li class="success">âœ“ Commande crÃ©Ã©e: ${result.trackingNumber}</li>`;
                } else {
                    output += '<li class="fail">âœ— CrÃ©ation commande Ã©chouÃ©e</li>';
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur crÃ©ation commande: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 3: Track order
            try {
                const api = new DeliveryAPI();
                const tracking = await api.trackOrder('TEST123');
                if (tracking.orderId) {
                    output += `<li class="success">âœ“ Suivi commande: ${tracking.status}</li>`;
                } else {
                    output += '<li class="fail">âœ— Suivi commande Ã©chouÃ©</li>';
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur suivi: ${e.message}</li>`;
                allPassed = false;
            }

            // Test 4: Validate address
            try {
                const api = new DeliveryAPI();
                const validation = api.validateAddress({
                    street: '123 Rue de la Paix',
                    city: 'Paris',
                    postalCode: '75001',
                    phone: '0612345678'
                });
                if (validation.valid) {
                    output += '<li class="success">âœ“ Validation adresse rÃ©ussie</li>';
                } else {
                    output += `<li class="fail">âœ— Validation Ã©chouÃ©e: ${validation.errors.join(', ')}</li>`;
                    allPassed = false;
                }
            } catch (e) {
                output += `<li class="fail">âœ— Erreur validation: ${e.message}</li>`;
                allPassed = false;
            }

            output += '</ul>';
            
            if (allPassed) {
                output = '<div class="result"><strong>Tous les tests de livraison sont passÃ©s! âœ“</strong></div>' + output;
            } else {
                output = '<div class="result error"><strong>Certains tests ont Ã©chouÃ©! âœ—</strong></div>' + output;
            }
            
            results.innerHTML = output;
        }
    </script>
</body>
</html>
